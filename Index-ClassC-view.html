<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Congress Simulation Lightboard ‚Äì Student View</title>

  <!-- Firebase compat libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 20px; }
    h1 { text-align: center; margin-bottom: 10px; }
    .top-container { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 15px; }
    .committee-panel { flex: 1; padding: 10px; border-radius: 8px; background: #1b1b1b; max-height: 400px; overflow-y: auto; }
    .house-panel { border: 2px solid #00c853; }
    .senate-panel { border: 2px solid #2196f3; }
    .committee-panel h3 { text-align: center; margin-top: 0; cursor: pointer; }
    .committee-list { min-height: 60px; background: #222; padding: 8px; border-radius: 6px; font-size: 0.9em; }
    .collapsed { display: none; }
    .dashboard { text-align: center; margin-bottom: 15px; font-weight: bold; }
    .bill-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px; }
    .bill { border: 1px solid #444; border-radius: 10px; padding: 10px; background: #222; }
    .bill h2 { text-align: center; font-size: 1.1em; margin-bottom: 10px; }
    .actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; text-align: center; }
    .light-wrapper { display: flex; flex-direction: column; align-items: center; }
    .light { width: 25px; height: 25px; border-radius: 50%; border: 2px solid #555; margin-bottom: 4px; }
    .light.green { background: #00c853; }
    .light.red { background: #d50000; }
    .light.gray { background: gray; }
    .status { margin-top: 6px; text-align: center; font-weight: bold; }
    .status.green { color: #00c853; }
    .status.red { color: #d50000; }
    .status.yellow { color: #ffd600; }
    .status.gray { color: gray; }
  </style>
</head>

<body>
  <h1>Congressional Lightboard ‚Äì Read-Only View</h1>

  <div class="top-container">
    <div class="committee-panel house-panel">
      <h3 onclick="this.nextElementSibling.classList.toggle('collapsed')">üèõÔ∏è House Committee Passed</h3>
      <div id="houseCommitteeList" class="committee-list"></div>
    </div>
    <div class="committee-panel senate-panel">
      <h3 onclick="this.nextElementSibling.classList.toggle('collapsed')">üèõÔ∏è Senate Committee Passed</h3>
      <div id="senateCommitteeList" class="committee-list"></div>
    </div>
  </div>

  <div class="dashboard" id="dashboard">Loading‚Ä¶</div>
  <div id="lightboard" class="bill-container"></div>

  <script>
    // ---- Firebase Init ----
    const firebaseConfig = {
      apiKey: "AIzaSyB0Scx7kkt3yY0TVIrPTMLtER1sqBW31cU",
      authDomain: "congreightboard.firebaseapp.com",
      projectId: "congreightboard",
      storageBucket: "congreightboard.appspot.com",
      messagingSenderId: "442171722171",
      appId: "1:442171722171:web:167640f2e6986056605c9e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const CLASS_ID = "ClassC";
    const actionList = [
      { name: "Introduced (H)", key: "introH" },
      { name: "Introduced (S)", key: "introS" },
      { name: "Committee (H)", key: "commH" },
      { name: "Committee (S)", key: "commS" },
      { name: "Amendments (H)", key: "amendH" },
      { name: "Amendments (S)", key: "amendS" },
      { name: "Passed (H)", key: "passedH" },
      { name: "Passed (S)", key: "passedS" },
      { name: "Signed (P)", key: "signedP" }
    ];
    let houseSelectionOrder = [];
    let senateSelectionOrder = [];

    function createBillElement(billNumber) {
      const billDiv = document.createElement("div");
      billDiv.className = "bill";
      const title = document.createElement("h2");
      title.textContent = "Bill " + billNumber;
      billDiv.appendChild(title);
      const actionsDiv = document.createElement("div");
      actionsDiv.className = "actions";

      const lights = actionList.map(a => {
        const wrap = document.createElement("div");
        wrap.className = "light-wrapper";
        const light = document.createElement("div");
        light.className = "light gray";
        wrap.appendChild(light);
        const label = document.createElement("div");
        label.style.fontSize = "0.65em";
        label.textContent = a.name;
        wrap.appendChild(label);
        actionsDiv.appendChild(wrap);
        return light;
      });

      billDiv.appendChild(actionsDiv);
      const statusDiv = document.createElement("div");
      statusDiv.className = "status gray";
      statusDiv.textContent = "No Action";
      billDiv.appendChild(statusDiv);
      billDiv.lights = lights;
      billDiv.statusDiv = statusDiv;
      return billDiv;
    }

    function updateOverallStatus(billDiv) {
      const lights = billDiv.lights;
      const getColor = k => lights[actionList.findIndex(a => a.key === k)].classList[1];
      const introH = getColor("introH"), introS = getColor("introS");
      const passedH = getColor("passedH"), passedS = getColor("passedS"), signedP = getColor("signedP");
      const introduced = introH === "green" || introS === "green";
      const bothFailed = passedH === "red" && passedS === "red";
      const bothPassed = passedH === "green" && passedS === "green";
      const failedPresident = signedP === "red";
      let color = "yellow", text = "In Progress";
      if (!introduced) { color = "gray"; text = "No Action"; }
      else if (bothFailed || failedPresident) { color = "red"; text = "Failed"; }
      else if (bothPassed && signedP === "green") { color = "green"; text = "Law"; }
      billDiv.statusDiv.className = `status ${color}`;
      billDiv.statusDiv.textContent = text;
    }

    function updateCommitteeLists() {
      const houseList = document.getElementById("houseCommitteeList");
      const senateList = document.getElementById("senateCommitteeList");
      houseList.innerHTML = "";
      senateList.innerHTML = "";
      const allBills = document.querySelectorAll(".bill");

      houseSelectionOrder = [];
      senateSelectionOrder = [];

      allBills.forEach(bill => {
        const lights = bill.lights;
        const getColor = k => lights[actionList.findIndex(a => a.key === k)].classList[1];
        const commH = getColor("commH"), commS = getColor("commS");
        const passedH = getColor("passedH"), passedS = getColor("passedS");
        const amendH = getColor("amendH"), amendS = getColor("amendS");
        const billNum = bill.querySelector("h2").textContent;

        if (commH === "green" || passedS === "green") houseSelectionOrder.push(billNum);
        if (commS === "green" || passedH === "green") senateSelectionOrder.push(billNum);
      });

      houseSelectionOrder.forEach(num => {
        const bill = Array.from(document.querySelectorAll(".bill")).find(b => b.querySelector("h2").textContent === num);
        const amendH = bill.lights[actionList.findIndex(a => a.key === "amendH")].classList[1];
        const passedS = bill.lights[actionList.findIndex(a => a.key === "passedS")].classList[1];
        const div = document.createElement("div");
        div.textContent = num + (amendH === "green" ? " *" : "") + (passedS === "green" ? " +" : "");
        houseList.appendChild(div);
      });
      senateSelectionOrder.forEach(num => {
        const bill = Array.from(document.querySelectorAll(".bill")).find(b => b.querySelector("h2").textContent === num);
        const amendS = bill.lights[actionList.findIndex(a => a.key === "amendS")].classList[1];
        const passedH = bill.lights[actionList.findIndex(a => a.key === "passedH")].classList[1];
        const div = document.createElement("div");
        div.textContent = num + (amendS === "green" ? " *" : "") + (passedH === "green" ? " +" : "");
        senateList.appendChild(div);
      });
    }

    function updateDashboard() {
      const allBills = document.querySelectorAll(".bill");
      let noAction = 0, inProgress = 0, failed = 0, law = 0;
      allBills.forEach(b => {
        const s = b.statusDiv.textContent;
        if (s === "No Action") noAction++;
        else if (s === "In Progress") inProgress++;
        else if (s === "Failed") failed++;
        else if (s === "Law") law++;
      });
      document.getElementById("dashboard").textContent =
        `No Action: ${noAction} | In Progress: ${inProgress} | Failed: ${failed} | Law: ${law}`;
    }

    async function loadFromFirebase() {
      const docSnap = await db.collection("lightboard").doc(CLASS_ID).get();
      return docSnap.exists ? docSnap.data().data : {};
    }

    async function renderBoard() {
      const savedData = await loadFromFirebase();
      const lightboard = document.getElementById("lightboard");
      lightboard.innerHTML = "";
      for (let i = 101; i <= 280; i++) {
        const billDiv = createBillElement(i);
        const saved = savedData[i];
        if (saved) {
          actionList.forEach((a, idx) => {
            billDiv.lights[idx].className = `light ${saved[idx]}`;
          });
          updateOverallStatus(billDiv);
        }
        lightboard.appendChild(billDiv);
      }
      updateCommitteeLists();
      updateDashboard();
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderBoard();
      setInterval(renderBoard, 10000); // refresh every 10 seconds
    });
  </script>
</body>
</html>